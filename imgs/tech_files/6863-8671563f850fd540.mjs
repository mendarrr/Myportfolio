"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[6863],{983617:(e,t,r)=>{r.d(t,{Z:()=>i});var s=r(773285),a=r(19121);let i=()=>{let{checkExperiment:e}=(0,s.F)(),t=(0,a.Z)(),r=!!t.isAuth&&t.isPartner;return!!r&&!!(e("web_m10n_business_hierarchy_alpha").anyEnabled||e("aid_exp_global_account_switcher_beta").anyEnabled||e("aid_exp_global_account_switcher_ga").anyEnabled)}},812173:(e,t,r)=>{r.d(t,{FE:()=>C,lG:()=>I,d9:()=>f});var s=r(667294),a=r(616550),i=r(983617),n=r(558211),u=r(773285),l=r(19121),c=r(67347);let d=()=>{let e=(0,l.Z)(),{checkExperiment:t}=(0,u.F)(),r=(0,i.Z)()&&t("web_m10n_business_reporting_business_entity_service").anyEnabled,[a,d]=(0,s.useState)({isReady:!1}),_=(0,s.useCallback)(async({entityId:e,actingBusinessId:t,favorites:s})=>{r&&(await (0,n.yo)({entityId:e,actingBusinessId:t,favorites:s}),d(e=>{let r={...e,actingBusinessId:t};if(s){var a;r.favoriteAdAccounts={favoriteAdAccountsMap:{...(null===(a=e.favoriteAdAccounts)||void 0===a?void 0:a.favoriteAdAccountsMap)||{},[s.actingBusinessId]:{advertiserId:s.adAccounts}}}}return r}))},[r]);return(0,s.useEffect)(()=>{r&&e.isAuth&&!a.isReady&&(async()=>{let t=!1;try{let t=await (0,n.SF)({entityId:e.id});d(e=>({...e,...t}))}catch(e){t=!0}finally{(0,c.nP)("globalAccountSwitcher.getFavoriteAdAccounts",{sampleRate:1,tags:{businessId:e.id,hasError:t}}),d(e=>({...e,isReady:!0}))}})()},[a.isReady,r,e]),{accountSwitcherConfig:a,setConfig:_}};var _=r(505025),S=r(407043),m=r(425288),o=r(53987),A=r(826067),E=r(433835),p=r(721344),g=r(785893);let{Provider:y,useHook:f}=(0,m.Z)("AccountSwitcherContext"),I=e=>e.search&&(0,A.mB)(e.search).advertiserId,C=({children:e})=>{let t=(0,a.TH)(),{params:{userBizId:r,businessHierarchyId:u,advertiserId:c,username:m}}=(0,a.$B)(),A=I(t),f=(0,l.Z)(),[C,N]=(0,s.useState)(""),[$,h]=(0,s.useState)(null),[O,R]=(0,s.useState)(!1),[U,T]=(0,s.useState)(null),[v,b]=(0,s.useState)(null),[L,B]=(0,s.useState)(!1),P=(0,i.Z)(),{logContextEvent:D}=(0,S.v)(),{accountSwitcherConfig:w,setConfig:H}=d();(0,s.useEffect)(()=>{u?N(u):N("")},[u]);let Z=(0,s.useCallback)(async({id:e,username:t})=>{let r=await (0,n.bG)({user_id:e,username:t});r&&T({type:e?_.Oz.BUSINESS_ACCOUNT:_.Oz.PROFILE,id:e||r.id,name:r.full_name,img:r.image_medium_url,username:t}),B(!1)},[]),G=(0,p.rc)(m);(0,s.useEffect)(()=>{(0,o.cD)(t)&&U&&G!==m&&m===f.username&&(Z({username:f.username}),b({id:f.id||"",name:f.fullName||"",img:f.imageMediumUrl||""}),h({type:_.nt,id:f.id}))},[t,G,Z,U,m,f.fullName,f.id,f.imageMediumUrl,f.username]),(0,s.useEffect)(()=>{let e=async({businessId:e,assetId:t})=>{if(!e){B(!1);return}try{let{data:{data:{asset:r,type:s}}}=await (0,E.G2)({businessId:e,assetId:t,resourceType:"AD_ACCOUNT",includeAssetSummary:!0});T({id:t,name:r.name,img:"",type:s})}catch(e){T({id:f.id||"",name:f.fullName||"",img:f.imageMediumUrl||"",type:_.Oz.BUSINESS_ACCOUNT})}B(!1)},s=async({id:e})=>{let t=await (0,n.p)({hierarchyId:e});T({id:e,name:null!=t&&t.data?t.data.name:"",img:null!=t&&t.data?t.data.img_medium_url:"",type:_.Oz.BUSINESS_HIERARCHY}),B(!1)};if(f.isAuth&&P&&!U){let a=(0,o.TI)(t)||(0,o.h3)(t),i=c||!!A&&!a;B(!0),u?s({id:u}):r?Z({id:r}):(0,o.cD)(t)&&m?Z({username:m}):i?e({businessId:f.id,assetId:c||A||""}):(T({type:_.Oz.BUSINESS_ACCOUNT,id:f.id||"",name:f.fullName||"",img:f.imageMediumUrl||""}),B(!1))}},[U,f,u,r,m,c,A,v,P,t,Z,L]),(0,s.useEffect)(()=>{let e=new URLSearchParams(t.search);v||e.has("actingBusinessId")||b({id:f.id||"",name:f.fullName||"",img:f.imageMediumUrl||""})},[v,t.search,f]);let M=(0,s.useMemo)(()=>({activePanel:$,selectedHierarchyId:C,switcherOpen:O,openAccountSwitcher:()=>{if(D({event_type:101,view_type:608,component:14346}),!$){if((0,o.TI)(t))h({type:_.v8});else{let e=new URLSearchParams(t.search),r=e.get("actingBusinessId");h({type:_.nt,id:null!=r?r:null==v?void 0:v.id})}}R(!0)},closeAccountSwitcher:()=>R(!1),openAssetPanel:e=>{h({type:_.nt,id:e})},closeAssetPanel:()=>{h({type:_.v8})},actingBusiness:v,selectedAccount:U,setSelectedAccount:T,setActingBusiness:b,accountSwitcherConfig:w,setConfig:H}),[$,C,O,v,U,w,H,D,t]);return(0,g.jsx)(y,{value:M,children:e})}},453933:(e,t,r)=>{r.d(t,{C:()=>p,H:()=>g});var s=r(667294),a=r(983617),i=r(505025),n=r(558211),u=r(56641),l=r(326884),c=r(668040),d=r(425288),_=r(186656),S=r(401060),m=r(19121),o=r(321545),A=r(785893);let{Provider:E,useHook:p}=(0,d.Z)("BusinessHierarchyContext"),g=({children:e})=>{let[t,r]=(0,s.useState)([]),[d,p]=(0,s.useState)(!1),[g,y]=(0,s.useState)(!1),[f,I]=(0,s.useState)({}),[C,N]=(0,s.useState)(null),[$,h]=(0,s.useState)([]),[O,R]=(0,s.useState)({}),U=(0,o.Z)(),T=(0,s.useRef)(U),v=(0,m.Z)(),b=(0,a.Z)(),L=(0,s.useRef)({}),B=(0,s.useCallback)((e,t)=>{let r;t===i.Oz.BUSINESS_HIERARCHY?r=(0,c.Z)(l.Q6.DASHBOARD,"","",e):t===i.Oz.BUSINESS_ACCOUNT&&(r=(0,c.Z)(l.Q6.DASHBOARD,e));let s=(0,S.Z)({site:"www",path:r});(0,u.Z)(s)},[]),P=(0,s.useCallback)(async e=>{if(!b)return[];if(y(!0),L.current[e])return y(!1),L.current[e];{let t=await (0,_.Z)({url:"ads/v4/business_access/business_hierarchies/",data:{search_by:["FULL_NAME","BUSINESS_ID"],search_value:e}}),{data:r}=t.resource_response,s=r&&r.map(e=>(e.children&&(e.children=e.children.map(e=>(e.user.entity_type=i.Oz.USER_ACCOUNT,e))),e))||[],a=/^\d+$/.test(e),u=RegExp(e.toLowerCase(),"g"),l=[];C||N(l=await T.current());let c=null!=C?C:l,d=c.filter(t=>{if(a)return t.id.includes(e);let r=t.user.full_name.toLowerCase();return r.match(u)}).map(n.IT),S=[...s.map(e=>e.id),...d.map(e=>e.id)],m=a?(v.id||"").includes(e):(v.fullName||"").toLowerCase().match(u);return v.isAuth&&m&&S.push(v.id),L.current[e]=S,y(!1),S}},[b,T,v.id,v.fullName,v.isAuth,C]),{id:D="",username:w="",email:H="",fullName:Z="",imageSmallUrl:G="",imageMediumUrl:M="",isAuth:z}=v,F=async e=>{if((!z||!b||C)&&!e)return;p(!0);let t=[];try{let e=await (0,_.Z)({url:"ads/v4/business_access/business_hierarchies/"}),{data:s}=e.resource_response;t=s&&s.map(e=>(e.children&&(e.children=e.children.map(e=>(e.user.entity_type=i.Oz.USER_ACCOUNT,e))),e))||[],r(t)}catch(e){r([])}try{let e=[];C||(e=await T.current(),N(e));let r=null!=C?C:e;h(r.map(n.IT)),R(r.reduce((e,t)=>(e[t.id]=t.business_roles||[],e),{})),I((0,n.WP)({id:D,username:w,email:H,fullName:Z,imageSmallUrl:G,imageMediumUrl:M})),L.current[""]=[...t.map(e=>e.id),...r.map(n.IT).map(e=>e.id),D],p(!1)}catch(e){p(!1)}},k=(0,s.useCallback)(F,[D,w,H,Z,G,M,z,b,C]),x=(0,s.useCallback)(e=>t.some(t=>t.id===e||t.children.some(t=>t.id===e||t.user.id===e)),[t]),Y=(0,s.useCallback)(e=>t.map(e=>"BUSINESS_HIERARCHY"===e.entity_type?e:null).find(t=>!!t&&t.children.some(t=>t.user.id===e)),[t]),j=(0,s.useMemo)(()=>({businessHierarchies:[...f.id&&!x(f.id)?[f]:[],...t,...$.filter(e=>!x(e.id))],switchAccount:B,searchAccounts:P,loadingAccounts:d,isSearchingAccounts:g,fetchData:k,getParentHierarchyForIdIfExists:Y,viewerRolesOfEachEmployer:O}),[t,B,P,$,d,g,f,k,x,Y,O]);return(0,A.jsx)(E,{value:j,children:e})}},558211:(e,t,r)=>{r.d(t,{IT:()=>d,SF:()=>A,Vq:()=>c,WP:()=>_,Yu:()=>o,bG:()=>m,p:()=>S,yo:()=>E});var s=r(214494),a=r(505025),i=r(186656),n=r(925672),u=r(180548),l=r(785893);let c=e=>({id:e.id,entity_type:a.Oz.BUSINESS_ACCOUNT,user:{id:e.user.id,entity_type:a.Oz.USER_ACCOUNT,username:e.user.username,email:e.user.email,full_name:e.user.full_name,image_small_url:e.user.image_small_url,image_medium_url:e.user.image_medium_url}}),d=e=>({id:e.id,entity_type:a.Oz.BUSINESS_ACCOUNT,requires_mfa_for_roles:e.requires_mfa_for_roles,user:{id:e.user.id,entity_type:a.Oz.USER_ACCOUNT,username:e.user.username,email:e.user.email,full_name:e.user.full_name,image_small_url:e.user.image_small_url,image_medium_url:e.user.image_medium_url}}),_=e=>({id:e.id,entity_type:a.Oz.BUSINESS_ACCOUNT,user:{id:e.id,entity_type:a.Oz.USER_ACCOUNT,username:e.username,email:e.email,full_name:e.fullName,image_small_url:e.imageSmallUrl,image_medium_url:e.imageMediumUrl}}),S=async({hierarchyId:e})=>{let t=await (0,i.Z)({url:`ads/v4/business_access/business_hierarchy/${e}/`});return t.resource_response},m=async({user_id:e,username:t})=>{if(!t&&!e)return null;let r=await s.Z.create("UserResource",{user_id:e,username:t}).callGet(),{resource_response:{data:a}}=r;return a},o=(0,l.jsx)("hr",{style:{borderTop:"1px solid #e9e9e9"}}),A=async({entityId:e})=>{let t=await (0,n.FO)([{entity_type:"BIZ_USER",entity_id:e,property_keys:["GLOBAL_ACCOUNT_SWITCHER_CONFIG"]}]),r=t[0];if(!(r&&r.properties))return{};let s=r.properties.GLOBAL_ACCOUNT_SWITCHER_CONFIG;return s},E=async({entityId:e,actingBusinessId:t,favorites:r})=>{let s={};(0,u.k)(t)||(s.actingBusinessId=t),r&&(s.favoriteAdAccounts={favoriteAdAccountsMap:{[r.actingBusinessId]:{advertiserId:r.adAccounts}}}),Object.keys(s).length>0&&await (0,n.RM)([{entity_type:"BIZ_USER",entity_id:e,properties:{GLOBAL_ACCOUNT_SWITCHER_CONFIG:s}}])}},668040:(e,t,r)=>{r.d(t,{Z:()=>i});let s="/business/business-manager/",a="/business/business-hierarchy/",i=(e,t,r,i)=>{switch(e){case"DASHBOARD":return i?`${a}${String(i)}/dashboard/`:`${s}${String(t)}/dashboard/`;case"PEOPLE":return`${s}${String(t)}/employees/`;case"PARTNERS":return`${s}${String(t)}/partners/`;case"AD_ACCOUNTS":return`${s}${String(t)}/ad-accounts/`;case"HISTORY":return`${s}${String(t)}/history/`;case"PEOPLE_DETAIL":return`${s}${String(t)}/employees/${String(r)}/details/`;case"PARTNERS_DETAIL":return`${s}${String(t)}/partners/${String(r)}/details/`;case"SHARED_PARTNERS_DETAIL":return`${s}${String(t)}/shared/${String(r)}/details/`;case"AD_ACCOUNTS_DETAIL":return`${s}${String(t)}/ad-accounts/${String(r)}/details/`;case"PENDING_AD_ACCOUNTS_DETAIL":return`${s}${String(t)}/ad-accounts/pending/${String(r)}/details/`;case"PEOPLE_INVITES":return`${s}${String(t)}/employees/invites/`;case"PEOPLE_PENDING_TAB":return`${s}${String(t)}/employees/pending/`;case"PARTNERS_PENDING_TAB":return`${s}${String(t)}/partners/pending/`;case"AD_ACCOUNTS_PENDING_TAB":return`${s}${String(t)}/ad-accounts/pending`;case"PARTNERS_INVITE_PAGE":return`${s}${String(t)}/partners/invites/`;case"PARTNERS_REQUEST_PAGE":return`${s}${String(t)}/partners/requests/`;case"PROFILES":return`${s}${String(t)}/profiles/`;case"PROFILES_DETAIL":return`${s}${String(t)}/profiles/${String(r)}/details/`;case"BUSINESS_SECURITY":return`${s}${String(t)}/security/`;case"SUPPORT_TOOL":return`${s}${String(t)}/support/`;case"ASSET_GROUPS":return r?`${s}${String(t)}/asset-groups/?asset_group_id=${String(r)}`:`${s}${String(t)}/asset-groups/`;case"INVOICE_MANAGEMENT":return`${s}${String(t)}/invoice-management/`;case"BUSINESS_HIERARCHY":return`${a}${String(i)}/hierarchy/`;case"BUSINESS_HIERARCHY_BUSINESS_SECURITY":return`${a}${String(i)}/business_security/`;case"MANAGERS":return`${a}${String(i)}/managers/`;case"AUDIENCES":return`${s}${String(t)}/audiences/`;case"SHARED_TAGS":return`${s}${String(t)}/shared-tags/`;case"CATALOGS":return`${s}${String(t)}/catalogs/`;default:return s}}},321545:(e,t,r)=>{r.d(t,{Z:()=>i});var s=r(186656),a=r(780280);function i(){let{experimentsClient:e}=(0,a.B)();return async()=>{var t;let{anyEnabled:r}=null!==(t=e.checkExperiment("business_access_employees_api_v4_migration"))&&void 0!==t?t:{},a=await (0,s.Z)({url:r?"/ads/v4/business_access/businesses/me/employers/":"ads/internal/business_access/users/me/employers/"}),i=a.resource_response?a.resource_response.data:{data:[]};return await Promise.all(i&&i.data||[])}}},721344:(e,t,r)=>{r.d(t,{XI:()=>a,YZ:()=>n,rc:()=>i,sU:()=>c});var s=r(667294);function a(e){let[t,r]=(0,s.useState)(!1),a=()=>r(!0),i=()=>r(!1);return(0,s.useEffect)(()=>{let{current:t}=e;return t&&(t.addEventListener("mouseenter",a),t.addEventListener("mouseleave",i)),()=>{t&&(t.removeEventListener("mouseenter",a),t.removeEventListener("mouseleave",i))}}),t}let i=e=>{let t=(0,s.useRef)(e);return(0,s.useEffect)(()=>{t.current=e}),t.current};function n(){let e=(0,s.useRef)(!0);return(0,s.useEffect)(()=>{e.current=!1},[]),e.current}function u(e,t){return Object.is(e,t)}let l=Symbol("pre-initial value");function c(e,{equal:t=u,delta:r}={equal:u}){let a=(0,s.useRef)(l),i=a.current;return(0,s.useEffect)(()=>{a.current=e}),{previousValue:i,changed:i===l||!t(i,e),delta:null==r?void 0:r(i,e)}}}}]);
//# sourceMappingURL=https://sm.pinimg.com/webapp/6863-8671563f850fd540.mjs.map